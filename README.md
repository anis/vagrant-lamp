# vagrant-web
Vagrant-web sets up a web-development environment on **Windows hosts**, via a Debian-based [Vagrant box][3].

The default features of the box are:
* a [samba share][9]: the most efficient way to share files with Windows hosts (_and symlink-problems free!_)
* configuration of your git/github accounts

The provisioning based on [Puppet][6] (_along with [Librarian-Puppet][5]_) lets you customize these, and even more, the way you want it!

## Requirements
* Windows 7 or higher
* [Git][10], in any version
* [Vagrant 1.7][1] or higher
* [Virtualbox 4.3][2] or higher

Seriously, that **really** is all you will need, so make sure everything is correctly installed and that both **Git** and **Vagrant** binaries are in your PATH.

## Installation
Clone this repository in the folder of your choice:

```sh
$ git clone https://github.com/anis/vagrant-web.git
```

The Puppet provisioning we prepared for you needs a configuration file:
```sh
$ cp .\puppet\manifests\config.pp.dist .\puppet\manifests\config.pp
```

We are done:

```sh
$ vagrant up
```

## Usage
### Samba share
You should be able to [connect a network drive][7] with the following settings:
* share pathname: `\\192.168.19.89\vagrant`
* username: `root`
* password: `samba`

In case of failure, make sure you have not changed the IP of your box in `Vagrantfile` or that the [name of your workgroup][8] is correct in `puppets/manifests/samba.pp`

### SSH connection
To connect to your guest, establish an ssh connection with the classic credentials:
* username: `vagrant`
* password: `vagrant`

```sh
$ ssh vagrant@192.168.19.89
$ vagrant@192.168.19.89's password: vagrant
```

Also, remember you can use the private key automatically generated by Vagrant at `vagrant-web\.vagrant\machines\default\virtualbox\private_key`

### Git account
Your name and email can be set up in puppet's `config.pp`. Just uncomment and complete these lines:
```ruby
# $gitUser = "My name"
# $gitEmail = "my@email.com"
```

If you are working with a Github account, set-up an SSH key authentication by simply pasting your private key in `config.pp`:
```ruby
# $githubSSHKey = "myPrivateKey"
```

### Vagrantfile
To make your customization easier, most common configuration entries are listed in the top of `Vagrantfile`, but you can go deeper if you know what you are doing.

In that case, you would want to get a look at how the Vagrant plugins we use work:
* [vagrant-vbguest][11]: installs virtualbox guest additions
* [vagrant-puppet-install][12]: installs puppet on your guest
* [vagrant-puppet-modules][13]: installs librarian-puppet and puppet modules on your guest

### Puppet
This is where you can go crazy! Do whatever you want in the provisioning by:
* installing Puppet modules via [puppet/Puppetfile][5]
* writing your manifests in `puppet\manifests`

## Known issues
* **Vagrant won't get my box up and Virtualbox tells me 'VT-X is not available'**

You might have Hyper-V activated, a Windows feature that prevents your machine to boot with two processors or more. You have two potential solutions:
* reduce the number of CPUs assigned to your machine to 1 (_in Vagrantfile_)
* deactivate Hyper-V: see [this tutorial][4]

* **Ruby raises an exception : ERROR: While executing gem ... (Encoding::UndefinedConversionError)**

Your Ruby is not using the appropriate encoding. You have two solutions (_both ugly_):
* type `chcp 1252` in Windows command prompt. You will have to do that each time you open a command prompt.
* locate `registry.rb` in your local ruby install and replace `LOCALE = Encoding.find(Encoding.locale_charmap)` by `LOCALE = Encoding::UTF_8`

* **I customized values in `config.pp` but I don't see any change**

You probably just forgot to provision your guest:
```sh
$ vagrant provision
```

[1]: http://www.vagrantup.com/downloads.html
[2]: https://www.virtualbox.org/wiki/Downloads
[3]: http://www.vagrantup.com
[4]: http://www.eightforums.com/tutorials/42041-hyper-v-enable-disable-windows-8-a.html
[5]: https://github.com/rodjek/librarian-puppet
[6]: https://docs.puppetlabs.com/learning/introduction.html
[7]: http://www.dummies.com/how-to/content/how-to-map-a-network-folder-in-windows-7.html
[8]: http://www.7tutorials.com/how-change-workgroup-windows-7
[9]: http://debian-handbook.info/browse/fr-FR/stable/sect.windows-file-server-with-samba.html
[10]: http://git-scm.com/downloads
[11]: https://github.com/dotless-de/vagrant-vbguest
[12]: https://github.com/petems/vagrant-puppet-install
[13]: https://github.com/anis/vagrant-puppet-modules